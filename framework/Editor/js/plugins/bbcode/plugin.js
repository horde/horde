(function(){CKEDITOR.on("dialogDefinition",function(d){var c,b=d.data.name,a=d.data.definition;if(b=="link"){a.removeContents("target");a.removeContents("upload");a.removeContents("advanced");c=a.getContents("info");c.remove("emailSubject");c.remove("emailBody")}else{if(b=="image"){a.removeContents("advanced");c=a.getContents("Link");c.remove("cmbTarget");c=a.getContents("info");c.remove("txtAlt");c.remove("basic")}}});var H={b:"strong",u:"u",i:"em",color:"span",size:"span",quote:"blockquote",code:"code",url:"a",email:"span",img:"span","*":"li",list:"ol"},G={strong:"b",b:"b",u:"u",em:"i",i:"i",code:"code",li:"*"},F={strong:"b",em:"i",u:"u",li:"*",ul:"list",ol:"list",code:"code",a:"link",img:"img",blockquote:"quote"},E={color:"color",size:"font-size"},D={url:"href",email:"mailhref",quote:"cite",list:"listType"},C=CKEDITOR.dtd,B=CKEDITOR.tools.extend({table:1},C.$block,C.$listItem,C.$tableContent,C.$list),A=/\s*(?:;\s*|$)/;function z(e){var d="";for(var c in e){var b=e[c],a=(c+":"+b).replace(A,";");d+=a}return d}function y(b){var a={};(b||"").replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(e,d,c){a[d.toLowerCase()]=c});return a}function x(a){return a.replace(/(?:rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\))/gi,function(g,f,e,d){f=parseInt(f,10).toString(16);e=parseInt(e,10).toString(16);d=parseInt(d,10).toString(16);var c=[f,e,d];for(var b=0;b<c.length;b++){c[b]=String("0"+c[b]).slice(-2)}return"#"+c.join("")})}var w={smiley:":)",sad:":(",wink:";)",laugh:":D",cheeky:":P",blush:":*)",surprise:":-o",indecision:":|",angry:">:(",angel:"o:)",cool:"8-)",devil:">:-)",crying:";(",kiss:":-*"},v={},u=[];for(var t in w){v[w[t]]=t;u.push(w[t].replace(/\(|\)|\:|\/|\*|\-|\|/g,function(a){return"\\"+a}))}u=new RegExp(u.join("|"),"g");var s=(function(){var c=[],b={nbsp:"\xa0",shy:"",gt:">",lt:"<"};for(var a in b){c.push(a)}c=new RegExp("&("+c.join("|")+");","g");return function(d){return d.replace(c,function(f,e){return b[e]})}})();CKEDITOR.BBCodeParser=function(){this._={bbcPartsRegex:/(?:\[([^\/\]=]*?)(?:=([^\]]*?))?\])|(?:\[\/([a-z]{1,16})\])/ig}};CKEDITOR.BBCodeParser.prototype={parse:function(a){var b=this;var k,j,i=0;while(k=b._.bbcPartsRegex.exec(a)){var h=k.index;if(h>i){var g=a.substring(i,h);b.onText(g,1)}i=b._.bbcPartsRegex.lastIndex;j=(k[1]||k[3]||"").toLowerCase();if(j&&!H[j]){b.onText(k[0]);continue}if(k[1]){var f=H[j],e={},d={},c=k[2];if(c){if(j=="list"){if(!isNaN(c)){c="decimal"}else{if(/^[a-z]+$/.test(c)){c="lower-alpha"}else{if(/^[A-Z]+$/.test(c)){c="upper-alpha"}}}}if(E[j]){if(j=="size"){c+="%"}d[E[j]]=c;e.style=z(d)}else{if(D[j]){e[D[j]]=c}}}if(j=="email"||j=="img"){e.bbcode=j}b.onTagOpen(f,e,CKEDITOR.dtd.$empty[f])}else{if(k[3]){b.onTagClose(H[j])}}}if(a.length>i){b.onText(a.substring(i,a.length),1)}}};CKEDITOR.htmlParser.fragment.fromBBCode=function(a){var l=new CKEDITOR.BBCodeParser(),k=new CKEDITOR.htmlParser.fragment(),j=[],i=0,h=k,g;function f(J){if(j.length>0){for(var q=0;q<j.length;q++){var p=j[q],o=p.name,n=CKEDITOR.dtd[o],m=h.name&&CKEDITOR.dtd[h.name];if((!m||m[o])&&(!J||!n||n[J]||!CKEDITOR.dtd[J])){p=p.clone();p.parent=h;h=p;j.splice(q,1);q--}}}}function e(L,K){var q=h.children.length,p=q>0&&h.children[q-1],o=!p&&r.getRule(F[h.name],"breakAfterOpen"),n=p&&p.type==CKEDITOR.NODE_ELEMENT&&r.getRule(F[p.name],"breakAfterClose"),m=L&&r.getRule(F[L],K?"breakBeforeClose":"breakBeforeOpen");if(i&&(o||n||m)){i--}if(i&&L in B){i++}while(i&&i--){h.children.push(p=new CKEDITOR.htmlParser.element("br"))}}function d(p,o){e(p.name,1);o=o||h||k;var n=o.children.length,m=n>0&&o.children[n-1]||null;p.previous=m;p.parent=o;o.children.push(p);if(p.returnPoint){h=p.returnPoint;delete p.returnPoint}}l.onTagOpen=function(N,M,L){var q=new CKEDITOR.htmlParser.element(N,M);if(CKEDITOR.dtd.$removeEmpty[N]){j.push(q);return}var p=h.name,o=p&&(CKEDITOR.dtd[p]||(h._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span));if(o&&!o[N]){var n=false,m;if(N==p){d(h,h.parent)}else{if(N in CKEDITOR.dtd.$listItem){l.onTagOpen("ul",{});m=h;n=true}else{d(h,h.parent);j.unshift(h);n=true}}if(m){h=m}else{h=h.returnPoint||h.parent}if(n){l.onTagOpen.apply(this,arguments);return}}f(N);e(N);q.parent=h;q.returnPoint=g;g=0;if(q.isEmpty){d(q)}else{h=q}};l.onTagClose=function(J){for(var q=j.length-1;q>=0;q--){if(J==j[q].name){j.splice(q,1);return}}var p=[],o=[],n=h;while(n.type&&n.name!=J){if(!n._.isBlockLike){o.unshift(n)}p.push(n);n=n.parent}if(n.type){for(q=0;q<p.length;q++){var m=p[q];d(m,m.parent)}h=n;d(n,n.parent);if(n==h){h=h.parent}j=j.concat(o)}};l.onText=function(n){var m=CKEDITOR.dtd[h.name];if(!m||m["#"]){e();f();n.replace(/([\r\n])|[^\r\n]*/g,function(q,p){if(p!==undefined&&p.length){i++}else{if(q.length){var o=0;q.replace(u,function(L,K){d(new CKEDITOR.htmlParser.text(q.substring(o,K)),h);d(new CKEDITOR.htmlParser.element("smiley",{desc:v[L]}),h);o=K+L.length});if(o!=q.length){d(new CKEDITOR.htmlParser.text(q.substring(o,q.length)),h)}}}})}};l.parse(CKEDITOR.tools.htmlEncode(a));while(h.type){var c=h.parent,b=h;d(b,c);h=c}return k};CKEDITOR.htmlParser.BBCodeWriter=CKEDITOR.tools.createClass({$:function(){var a=this;a._={output:[],rules:[]};a.setRules("list",{breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});a.setRules("*",{breakBeforeOpen:1,breakAfterOpen:0,breakBeforeClose:1,breakAfterClose:0});a.setRules("quote",{breakBeforeOpen:1,breakAfterOpen:0,breakBeforeClose:0,breakAfterClose:1})},proto:{setRules:function(c,b){var a=this._.rules[c];if(a){CKEDITOR.tools.extend(a,b,true)}else{this._.rules[c]=b}},getRule:function(b,a){return this._.rules[b]&&this._.rules[b][a]},openTag:function(d,c){var a=this;if(d in H){if(a.getRule(d,"breakBeforeOpen")){a.lineBreak(1)}a.write("[",d);var b=c.option;b&&a.write("=",b);a.write("]");if(a.getRule(d,"breakAfterOpen")){a.lineBreak(1)}}else{if(d=="br"){a._.output.push("\n")}}},openTagClose:function(){},attribute:function(){},closeTag:function(b){var a=this;if(b in H){if(a.getRule(b,"breakBeforeClose")){a.lineBreak(1)}b!="*"&&a.write("[/",b,"]");if(a.getRule(b,"breakAfterClose")){a.lineBreak(1)}}},text:function(a){this.write(a)},comment:function(){},lineBreak:function(){var a=this;if(!a._.hasLineBreak&&a._.output.length){a.write("\n");a._.hasLineBreak=1}},write:function(){this._.hasLineBreak=0;var a=Array.prototype.join.call(arguments,"");this._.output.push(a)},reset:function(){this._.output=[];this._.hasLineBreak=0},getHtml:function(b){var a=this._.output.join("");if(b){this.reset()}return s(a)}}});var r=new CKEDITOR.htmlParser.BBCodeWriter();CKEDITOR.plugins.add("bbcode",{requires:["htmldataprocessor","entities"],beforeInit:function(b){var a=b.config;CKEDITOR.tools.extend(a,{enterMode:CKEDITOR.ENTER_BR,basicEntities:false,entities:false,fillEmptyBlocks:false},true)},init:function(d){var c=d.config;function b(g){var f=CKEDITOR.htmlParser.fragment.fromBBCode(g),e=new CKEDITOR.htmlParser.basicWriter();f.writeHtml(e,a);return e.getHtml(true)}var a=new CKEDITOR.htmlParser.filter();a.addRules({elements:{blockquote:function(g){var f=new CKEDITOR.htmlParser.element("div");f.children=g.children;g.children=[f];var e=g.attributes.cite;if(e){var h=new CKEDITOR.htmlParser.element("cite");h.add(new CKEDITOR.htmlParser.text(e.replace(/^"|"$/g,"")));delete g.attributes.cite;g.children.unshift(h)}},span:function(f){var e;if(e=f.attributes.bbcode){if(e=="img"){f.name="img";f.attributes.src=f.children[0].value;f.children=[]}else{if(e=="email"){f.name="a";f.attributes.href="mailto:"+f.children[0].value}}delete f.attributes.bbcode}},ol:function(e){if(e.attributes.listType){if(e.attributes.listType!="decimal"){e.attributes.style="list-style-type:"+e.attributes.listType}}else{e.name="ul"}delete e.attributes.listType},a:function(e){if(!e.attributes.href){e.attributes.href=e.children[0].value}},smiley:function(g){g.name="img";var f=g.attributes.desc,e=c.smiley_images[CKEDITOR.tools.indexOf(c.smiley_descriptions,f)],h=CKEDITOR.tools.htmlEncode(c.smiley_path+e);g.attributes={src:h,"data-cke-saved-src":h,title:f,alt:f}}}});d.dataProcessor.htmlFilter.addRules({elements:{$:function(m){var l=m.attributes,k=y(l.style),j,i=m.name;if(i in G){i=G[i]}else{if(i=="span"){if(j=k.color){i="color";j=x(j)}else{if(j=k["font-size"]){var h=j.match(/(\d+)%$/);if(h){j=h[1];i="size"}}}}else{if(i=="ol"||i=="ul"){if(j=k["list-style-type"]){switch(j){case"lower-alpha":j="a";break;case"upper-alpha":j="A";break}}else{if(i=="ol"){j=1}}i="list"}else{if(i=="blockquote"){try{var g=m.children[0],f=m.children[1],e=g.name=="cite"&&g.children[0].value;if(e){j='"'+e+'"';m.children=f.children}}catch(n){}i="quote"}else{if(i=="a"){if(j=l.href){if(j.indexOf("mailto:")!==-1){i="email";m.children=[new CKEDITOR.htmlParser.text(j.replace("mailto:",""))];j=""}else{var p=m.children.length==1&&m.children[0];if(p&&p.type==CKEDITOR.NODE_TEXT&&p.value==j){j=""}i="url"}}}else{if(i=="img"){m.isEmpty=0;var o=l["data-cke-saved-src"];if(o&&o.indexOf(d.config.smiley_path)!=-1){return new CKEDITOR.htmlParser.text(w[l.alt])}else{m.children=[new CKEDITOR.htmlParser.text(o)]}}}}}}}m.name=i;j&&(m.attributes.option=j);return null},br:function(f){var e=f.next;if(e&&e.name in B){return false}}}},1);d.dataProcessor.writer=r;d.on("beforeSetMode",function(f){f.removeListener();var e=d._.modes.wysiwyg;e.loadData=CKEDITOR.tools.override(e.loadData,function(g){return function(h){return g.call(this,b(h))}})})},afterInit:function(b){var a;if(b._.elementsPath){if(a=b._.elementsPath.filters){a.push(function(f){var e=f.getName(),d=F[e]||false;if(d=="link"&&f.getAttribute("href").indexOf("mailto:")===0){d="email"}else{if(e=="span"){if(f.getStyle("font-size")){d="size"}else{if(f.getStyle("color")){d="color"}}}else{if(d=="img"){var c=f.data("cke-saved-src");if(c&&c.indexOf(b.config.smiley_path)===0){d="smiley"}}}}return d})}}}})})();