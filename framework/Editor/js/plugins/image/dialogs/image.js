(function(){var b=function(ab,aa){var Z=1,Y=2,X=4,W=8,V=/^\s*(\d+)((px)|\%)?\s*$/i,U=/(^\s*(\d+)((px)|\%)?\s*$)|^$/i,T=/^\d+px$/,S=function(){var f=this.getValue(),e=this.getDialog(),d=f.match(V);if(d){if(d[2]=="%"){N(e,false)}f=d[1]}if(e.lockRatio){var c=e.originalElement;if(c.getCustomData("isReady")=="true"){if(this.id=="txtHeight"){if(f&&f!="0"){f=Math.round(c.$.width*(f/c.$.height))}if(!isNaN(f)){e.setValueOf("info","txtWidth",f)}}else{if(f&&f!="0"){f=Math.round(c.$.height*(f/c.$.width))}if(!isNaN(f)){e.setValueOf("info","txtHeight",f)}}}}R(e)},R=function(c){if(!c.originalElement||!c.preview){return 1}c.commitContent(X,c.preview);return 0};function Q(){var d=arguments,c=this.getContentElement("advanced","txtdlgGenStyle");c&&c.commit.apply(c,d);this.foreach(function(e){if(e.commit&&e.id!="txtdlgGenStyle"){e.commit.apply(e,d)}})}var P;function O(h){if(P){return}P=1;var g=this.getDialog(),f=g.imageElement;if(f){this.commit(Z,f);h=[].concat(h);var e=h.length,d;for(var c=0;c<e;c++){d=g.getContentElement.apply(g,h[c].split(":"));d&&d.setup(Z,f)}}P=0}var N=function(d,c){var l=d.originalElement;if(!l){return null}if(c=="check"){if(!d.userlockRatio&&l.getCustomData("isReady")=="true"){var k=d.getValueOf("info","txtWidth"),j=d.getValueOf("info","txtHeight"),i=l.$.width*1000/l.$.height,h=k*1000/j;d.lockRatio=false;if(!k&&!j){d.lockRatio=true}else{if(!isNaN(i)&&!isNaN(h)){if(Math.round(i)==Math.round(h)){d.lockRatio=true}}}}}else{if(c!=undefined){d.lockRatio=c}else{d.userlockRatio=1;d.lockRatio=!d.lockRatio}}var g=CKEDITOR.document.getById(E);if(d.lockRatio){g.removeClass("cke_btn_unlocked")}else{g.addClass("cke_btn_unlocked")}var f=d._.editor.lang.image,e=f[d.lockRatio?"unlockRatio":"lockRatio"];g.setAttribute("title",e);g.getFirst().setText(e);return d.lockRatio},L=function(d){var c=d.originalElement;if(c.getCustomData("isReady")=="true"){d.setValueOf("info","txtWidth",c.$.width);d.setValueOf("info","txtHeight",c.$.height)}R(d)},J=function(i,h){if(i!=Z){return}function g(l,k){var j=l.match(V);if(j){if(j[2]=="%"){j[1]+="%";N(f,false)}return j[1]}return k}var f=this.getDialog(),e="",d=this.id=="txtWidth"?"width":"height",c=h.getAttribute(d);if(c){e=g(c,e)}e=g(h.getStyle(d),e);this.setValue(e)},I,H=function(){var c=this.originalElement;c.setCustomData("isReady","true");c.removeListener("load",H);c.removeListener("error",G);c.removeListener("abort",G);CKEDITOR.document.getById(C).setStyle("display","none");if(!this.dontResetSize){L(this)}if(this.firstLoad){CKEDITOR.tools.setTimeout(function(){N(this,"check")},0,this)}this.firstLoad=false;this.dontResetSize=false},G=function(){var c=this;var e=c.originalElement;e.removeListener("load",H);e.removeListener("error",G);e.removeListener("abort",G);var d=CKEDITOR.getUrl(ab.skinPath+"images/noimage.png");if(c.preview){c.preview.setAttribute("src",d)}CKEDITOR.document.getById(C).setStyle("display","none");N(c,false)},F=function(c){return CKEDITOR.tools.getNextId()+"_"+c},E=F("btnLockSizes"),D=F("btnResetSize"),C=F("ImagePreviewLoader"),a=F("ImagePreviewBox"),M=F("previewLink"),K=F("previewImage");return{title:ab.lang.image[aa=="image"?"title":"titleButton"],minWidth:420,minHeight:360,onShow:function(){var c=this;c.imageElement=false;c.linkElement=false;c.imageEditMode=false;c.linkEditMode=false;c.lockRatio=true;c.userlockRatio=0;c.dontResetSize=false;c.firstLoad=true;c.addLink=false;var i=c.getParentEditor(),h=c.getParentEditor().getSelection(),g=h.getSelectedElement(),f=g&&g.getAscendant("a");CKEDITOR.document.getById(C).setStyle("display","none");I=new CKEDITOR.dom.element("img",i.document);c.preview=CKEDITOR.document.getById(K);c.originalElement=i.document.createElement("img");c.originalElement.setAttribute("alt","");c.originalElement.setCustomData("isReady","false");if(f){c.linkElement=f;c.linkEditMode=true;var e=f.getChildren();if(e.count()==1){var d=e.getItem(0).getName();if(d=="img"||d=="input"){c.imageElement=e.getItem(0);if(c.imageElement.getName()=="img"){c.imageEditMode="img"}else{if(c.imageElement.getName()=="input"){c.imageEditMode="input"}}}}if(aa=="image"){c.setupContent(Y,f)}}if(g&&g.getName()=="img"&&!g.data("cke-realelement")||g&&g.getName()=="input"&&g.getAttribute("type")=="image"){c.imageEditMode=g.getName();c.imageElement=g}if(c.imageEditMode){c.cleanImageElement=c.imageElement;c.imageElement=c.cleanImageElement.clone(true,true);c.setupContent(Z,c.imageElement)}else{c.imageElement=i.document.createElement("img")}N(c,true);if(!CKEDITOR.tools.trim(c.getValueOf("info","txtUrl"))){c.preview.removeAttribute("src");c.preview.setStyle("display","none")}},onOk:function(){var c=this;if(c.imageEditMode){var d=c.imageEditMode;if(aa=="image"&&d=="input"&&confirm(ab.lang.image.button2Img)){d="img";c.imageElement=ab.document.createElement("img");c.imageElement.setAttribute("alt","");ab.insertElement(c.imageElement)}else{if(aa!="image"&&d=="img"&&confirm(ab.lang.image.img2Button)){d="input";c.imageElement=ab.document.createElement("input");c.imageElement.setAttributes({type:"image",alt:""});ab.insertElement(c.imageElement)}else{c.imageElement=c.cleanImageElement;delete c.cleanImageElement}}}else{if(aa=="image"){c.imageElement=ab.document.createElement("img")}else{c.imageElement=ab.document.createElement("input");c.imageElement.setAttribute("type","image")}c.imageElement.setAttribute("alt","")}if(!c.linkEditMode){c.linkElement=ab.document.createElement("a")}c.commitContent(Z,c.imageElement);c.commitContent(Y,c.linkElement);if(!c.imageElement.getAttribute("style")){c.imageElement.removeAttribute("style")}if(!c.imageEditMode){if(c.addLink){if(!c.linkEditMode){ab.insertElement(c.linkElement);c.linkElement.append(c.imageElement,false)}else{ab.insertElement(c.imageElement)}}else{ab.insertElement(c.imageElement)}}else{if(!c.linkEditMode&&c.addLink){ab.insertElement(c.linkElement);c.imageElement.appendTo(c.linkElement)}else{if(c.linkEditMode&&!c.addLink){ab.getSelection().selectElement(c.linkElement);ab.insertElement(c.imageElement)}}}},onLoad:function(){var c=this;if(aa!="image"){c.hidePage("Link")}var d=c._.element.getDocument();c.addFocusable(d.getById(D),5);c.addFocusable(d.getById(E),5);c.commitContent=Q},onHide:function(){var c=this;if(c.preview){c.commitContent(W,c.preview)}if(c.originalElement){c.originalElement.removeListener("load",H);c.originalElement.removeListener("error",G);c.originalElement.removeListener("abort",G);c.originalElement.remove();c.originalElement=false}delete c.imageElement},contents:[{id:"info",label:ab.lang.image.infoTab,accessKey:"I",elements:[{type:"vbox",padding:0,children:[{type:"hbox",widths:["280px","110px"],align:"right",children:[{id:"txtUrl",type:"text",label:ab.lang.common.url,required:true,onChange:function(){var f=this.getDialog(),e=this.getValue();if(e.length>0){f=this.getDialog();var d=f.originalElement;f.preview.removeStyle("display");d.setCustomData("isReady","false");var c=CKEDITOR.document.getById(C);if(c){c.setStyle("display","")}d.on("load",H,f);d.on("error",G,f);d.on("abort",G,f);d.setAttribute("src",e);I.setAttribute("src",e);f.preview.setAttribute("src",I.$.src);R(f)}else{if(f.preview){f.preview.removeAttribute("src");f.preview.setStyle("display","none")}}},setup:function(f,e){if(f==Z){var d=e.data("cke-saved-src")||e.getAttribute("src"),c=this;this.getDialog().dontResetSize=true;c.setValue(d);c.setInitValue()}},commit:function(e,d){var c=this;if(e==Z&&(c.getValue()||c.isChanged())){d.data("cke-saved-src",c.getValue());d.setAttribute("src",c.getValue())}else{if(e==W){d.setAttribute("src","");d.removeAttribute("src")}}},validate:CKEDITOR.dialog.validate.notEmpty(ab.lang.image.urlMissing)},{type:"button",id:"browse",style:"display:inline-block;margin-top:10px;",align:"center",label:ab.lang.common.browseServer,hidden:true,filebrowser:"info:txtUrl"}]}]},{id:"txtAlt",type:"text",label:ab.lang.image.alt,accessKey:"T","default":"",onChange:function(){R(this.getDialog())},setup:function(d,c){if(d==Z){this.setValue(c.getAttribute("alt"))}},commit:function(e,d){var c=this;if(e==Z){if(c.getValue()||c.isChanged()){d.setAttribute("alt",c.getValue())}}else{if(e==X){d.setAttribute("alt",c.getValue())}else{if(e==W){d.removeAttribute("alt")}}}}},{type:"hbox",children:[{type:"vbox",children:[{type:"hbox",widths:["50%","50%"],children:[{type:"vbox",padding:1,children:[{type:"text",width:"40px",id:"txtWidth",label:ab.lang.common.width,onKeyUp:S,onChange:function(){O.call(this,"advanced:txtdlgGenStyle")},validate:function(){var d=this.getValue().match(U),c=!!(d&&parseInt(d[1],10)!==0);if(!c){alert(ab.lang.common.invalidWidth)}return c},setup:J,commit:function(h,g,f){var e=this.getValue();if(h==Z){if(e){g.setStyle("width",CKEDITOR.tools.cssLength(e))}else{g.removeStyle("width")}!f&&g.removeAttribute("width")}else{if(h==X){var d=e.match(V);if(!d){var c=this.getDialog().originalElement;if(c.getCustomData("isReady")=="true"){g.setStyle("width",c.$.width+"px")}}else{g.setStyle("width",CKEDITOR.tools.cssLength(e))}}else{if(h==W){g.removeAttribute("width");g.removeStyle("width")}}}}},{type:"text",id:"txtHeight",width:"40px",label:ab.lang.common.height,onKeyUp:S,onChange:function(){O.call(this,"advanced:txtdlgGenStyle")},validate:function(){var d=this.getValue().match(U),c=!!(d&&parseInt(d[1],10)!==0);if(!c){alert(ab.lang.common.invalidHeight)}return c},setup:J,commit:function(h,g,f){var e=this.getValue();if(h==Z){if(e){g.setStyle("height",CKEDITOR.tools.cssLength(e))}else{g.removeStyle("height")}!f&&g.removeAttribute("height")}else{if(h==X){var d=e.match(V);if(!d){var c=this.getDialog().originalElement;if(c.getCustomData("isReady")=="true"){g.setStyle("height",c.$.height+"px")}}else{g.setStyle("height",CKEDITOR.tools.cssLength(e))}}else{if(h==W){g.removeAttribute("height");g.removeStyle("height")}}}}}]},{type:"html",style:"margin-top:30px;width:40px;height:40px;",onLoad:function(){var d=CKEDITOR.document.getById(D),c=CKEDITOR.document.getById(E);if(d){d.on("click",function(e){L(this);e.data&&e.data.preventDefault()},this.getDialog());d.on("mouseover",function(){this.addClass("cke_btn_over")},d);d.on("mouseout",function(){this.removeClass("cke_btn_over")},d)}if(c){c.on("click",function(j){var e=this;var i=N(e),h=e.originalElement,g=e.getValueOf("info","txtWidth");if(h.getCustomData("isReady")=="true"&&g){var f=h.$.height/h.$.width*g;if(!isNaN(f)){e.setValueOf("info","txtHeight",Math.round(f));R(e)}}j.data.preventDefault()},this.getDialog());c.on("mouseover",function(){this.addClass("cke_btn_over")},c);c.on("mouseout",function(){this.removeClass("cke_btn_over")},c)}},html:'<div><a href="javascript:void(0)" tabindex="-1" title="'+ab.lang.image.unlockRatio+'" class="cke_btn_locked" id="'+E+'" role="button"><span class="cke_label">'+ab.lang.image.unlockRatio+'</span></a><a href="javascript:void(0)" tabindex="-1" title="'+ab.lang.image.resetSize+'" class="cke_btn_reset" id="'+D+'" role="button"><span class="cke_label">'+ab.lang.image.resetSize+"</span></a></div>"}]},{type:"vbox",padding:1,children:[{type:"text",id:"txtBorder",width:"60px",label:ab.lang.image.border,"default":"",onKeyUp:function(){R(this.getDialog())},onChange:function(){O.call(this,"advanced:txtdlgGenStyle")},validate:CKEDITOR.dialog.validate.integer(ab.lang.image.validateBorder),setup:function(f,e){if(f==Z){var d,c=e.getStyle("border-width");c=c&&c.match(/^(\d+px)(?: \1 \1 \1)?$/);d=c&&parseInt(c[1],10);isNaN(parseInt(d,10))&&(d=e.getAttribute("border"));this.setValue(d)}},commit:function(f,e,d){var c=parseInt(this.getValue(),10);if(f==Z||f==X){if(!isNaN(c)){e.setStyle("border-width",CKEDITOR.tools.cssLength(c));e.setStyle("border-style","solid")}else{if(!c&&this.isChanged()){e.removeStyle("border-width");e.removeStyle("border-style");e.removeStyle("border-color")}}if(!d&&f==Z){e.removeAttribute("border")}}else{if(f==W){e.removeAttribute("border");e.removeStyle("border-width");e.removeStyle("border-style");e.removeStyle("border-color")}}}},{type:"text",id:"txtHSpace",width:"60px",label:ab.lang.image.hSpace,"default":"",onKeyUp:function(){R(this.getDialog())},onChange:function(){O.call(this,"advanced:txtdlgGenStyle")},validate:CKEDITOR.dialog.validate.integer(ab.lang.image.validateHSpace),setup:function(i,h){if(i==Z){var g,f,e,d=h.getStyle("margin-left"),c=h.getStyle("margin-right");d=d&&d.match(T);c=c&&c.match(T);f=parseInt(d,10);e=parseInt(c,10);g=f==e&&f;isNaN(parseInt(g,10))&&(g=h.getAttribute("hspace"));this.setValue(g)}},commit:function(f,e,d){var c=parseInt(this.getValue(),10);if(f==Z||f==X){if(!isNaN(c)){e.setStyle("margin-left",CKEDITOR.tools.cssLength(c));e.setStyle("margin-right",CKEDITOR.tools.cssLength(c))}else{if(!c&&this.isChanged()){e.removeStyle("margin-left");e.removeStyle("margin-right")}}if(!d&&f==Z){e.removeAttribute("hspace")}}else{if(f==W){e.removeAttribute("hspace");e.removeStyle("margin-left");e.removeStyle("margin-right")}}}},{type:"text",id:"txtVSpace",width:"60px",label:ab.lang.image.vSpace,"default":"",onKeyUp:function(){R(this.getDialog())},onChange:function(){O.call(this,"advanced:txtdlgGenStyle")},validate:CKEDITOR.dialog.validate.integer(ab.lang.image.validateVSpace),setup:function(i,h){if(i==Z){var g,f,e,d=h.getStyle("margin-top"),c=h.getStyle("margin-bottom");d=d&&d.match(T);c=c&&c.match(T);f=parseInt(d,10);e=parseInt(c,10);g=f==e&&f;isNaN(parseInt(g,10))&&(g=h.getAttribute("vspace"));this.setValue(g)}},commit:function(f,e,d){var c=parseInt(this.getValue(),10);if(f==Z||f==X){if(!isNaN(c)){e.setStyle("margin-top",CKEDITOR.tools.cssLength(c));e.setStyle("margin-bottom",CKEDITOR.tools.cssLength(c))}else{if(!c&&this.isChanged()){e.removeStyle("margin-top");e.removeStyle("margin-bottom")}}if(!d&&f==Z){e.removeAttribute("vspace")}}else{if(f==W){e.removeAttribute("vspace");e.removeStyle("margin-top");e.removeStyle("margin-bottom")}}}},{id:"cmbAlign",type:"select",widths:["35%","65%"],style:"width:90px",label:ab.lang.common.align,"default":"",items:[[ab.lang.common.notSet,""],[ab.lang.common.alignLeft,"left"],[ab.lang.common.alignRight,"right"]],onChange:function(){R(this.getDialog());O.call(this,"advanced:txtdlgGenStyle")},setup:function(e,d){if(e==Z){var c=d.getStyle("float");switch(c){case"inherit":case"none":c=""}!c&&(c=(d.getAttribute("align")||"").toLowerCase());this.setValue(c)}},commit:function(f,e,d){var c=this.getValue();if(f==Z||f==X){if(c){e.setStyle("float",c)}else{e.removeStyle("float")}if(!d&&f==Z){c=(e.getAttribute("align")||"").toLowerCase();switch(c){case"left":case"right":e.removeAttribute("align")}}}else{if(f==W){e.removeStyle("float")}}}}]}]},{type:"vbox",height:"250px",children:[{type:"html",style:"width:95%;",html:"<div>"+CKEDITOR.tools.htmlEncode(ab.lang.common.preview)+'<br><div id="'+C+'" class="ImagePreviewLoader" style="display:none"><div class="loading">&nbsp;</div></div><div id="'+a+'" class="ImagePreviewBox"><table><tr><td><a href="javascript:void(0)" target="_blank" onclick="return false;" id="'+M+'"><img id="'+K+'" alt="" /></a>'+(ab.config.image_previewText||"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Maecenas feugiat consequat diam. Maecenas metus. Vivamus diam purus, cursus a, commodo non, facilisis vitae, nulla. Aenean dictum lacinia tortor. Nunc iaculis, nibh non iaculis aliquam, orci felis euismod neque, sed ornare massa mauris sed velit. Nulla pretium mi et risus. Fusce mi pede, tempor id, cursus ac, ullamcorper nec, enim. Sed tortor. Curabitur molestie. Duis velit augue, condimentum at, ultrices a, luctus ut, orci. Donec pellentesque egestas eros. Integer cursus, augue in cursus faucibus, eros pede bibendum sem, in tempus tellus justo quis ligula. Etiam eget tortor. Vestibulum rutrum, est ut placerat elementum, lectus nisl aliquam velit, tempor aliquam eros nunc nonummy metus. In eros metus, gravida a, gravida sed, lobortis id, turpis. Ut ultrices, ipsum at venenatis fringilla, sem nulla lacinia tellus, eget aliquet turpis mauris non enim. Nam turpis. Suspendisse lacinia. Curabitur ac tortor ut ipsum egestas elementum. Nunc imperdiet gravida mauris.")+"</td></tr></table></div></div>"}]}]}]},{id:"Link",label:ab.lang.link.title,padding:0,elements:[{id:"txtUrl",type:"text",label:ab.lang.common.url,style:"width: 100%","default":"",setup:function(e,d){if(e==Y){var c=d.data("cke-saved-href");if(!c){c=d.getAttribute("href")}this.setValue(c)}},commit:function(f,e){var c=this;if(f==Y){if(c.getValue()||c.isChanged()){var d=decodeURI(c.getValue());e.data("cke-saved-href",d);e.setAttribute("href",d);if(c.getValue()||!ab.config.image_removeLinkByEmptyURL){c.getDialog().addLink=true}}}}},{type:"button",id:"browse",filebrowser:{action:"Browse",target:"Link:txtUrl",url:ab.config.filebrowserImageBrowseLinkUrl},style:"float:right",hidden:true,label:ab.lang.common.browseServer},{id:"cmbTarget",type:"select",label:ab.lang.common.target,"default":"",items:[[ab.lang.common.notSet,""],[ab.lang.common.targetNew,"_blank"],[ab.lang.common.targetTop,"_top"],[ab.lang.common.targetSelf,"_self"],[ab.lang.common.targetParent,"_parent"]],setup:function(d,c){if(d==Y){this.setValue(c.getAttribute("target")||"")}},commit:function(d,c){if(d==Y){if(this.getValue()||this.isChanged()){c.setAttribute("target",this.getValue())}}}}]},{id:"Upload",hidden:true,filebrowser:"uploadButton",label:ab.lang.image.upload,elements:[{type:"file",id:"upload",label:ab.lang.image.btnUpload,style:"height:40px",size:38},{type:"fileButton",id:"uploadButton",filebrowser:"info:txtUrl",label:ab.lang.image.btnUpload,"for":["Upload","upload"]}]},{id:"advanced",label:ab.lang.common.advancedTab,elements:[{type:"hbox",widths:["50%","25%","25%"],children:[{type:"text",id:"linkId",label:ab.lang.common.id,setup:function(d,c){if(d==Z){this.setValue(c.getAttribute("id"))}},commit:function(d,c){if(d==Z){if(this.getValue()||this.isChanged()){c.setAttribute("id",this.getValue())}}}},{id:"cmbLangDir",type:"select",style:"width : 100px;",label:ab.lang.common.langDir,"default":"",items:[[ab.lang.common.notSet,""],[ab.lang.common.langDirLtr,"ltr"],[ab.lang.common.langDirRtl,"rtl"]],setup:function(d,c){if(d==Z){this.setValue(c.getAttribute("dir"))}},commit:function(d,c){if(d==Z){if(this.getValue()||this.isChanged()){c.setAttribute("dir",this.getValue())}}}},{type:"text",id:"txtLangCode",label:ab.lang.common.langCode,"default":"",setup:function(d,c){if(d==Z){this.setValue(c.getAttribute("lang"))}},commit:function(d,c){if(d==Z){if(this.getValue()||this.isChanged()){c.setAttribute("lang",this.getValue())}}}}]},{type:"text",id:"txtGenLongDescr",label:ab.lang.common.longDescr,setup:function(d,c){if(d==Z){this.setValue(c.getAttribute("longDesc"))}},commit:function(d,c){if(d==Z){if(this.getValue()||this.isChanged()){c.setAttribute("longDesc",this.getValue())}}}},{type:"hbox",widths:["50%","50%"],children:[{type:"text",id:"txtGenClass",label:ab.lang.common.cssClass,"default":"",setup:function(d,c){if(d==Z){this.setValue(c.getAttribute("class"))}},commit:function(d,c){if(d==Z){if(this.getValue()||this.isChanged()){c.setAttribute("class",this.getValue())}}}},{type:"text",id:"txtGenTitle",label:ab.lang.common.advisoryTitle,"default":"",onChange:function(){R(this.getDialog())},setup:function(d,c){if(d==Z){this.setValue(c.getAttribute("title"))}},commit:function(e,d){var c=this;if(e==Z){if(c.getValue()||c.isChanged()){d.setAttribute("title",c.getValue())}}else{if(e==X){d.setAttribute("title",c.getValue())}else{if(e==W){d.removeAttribute("title")}}}}}]},{type:"text",id:"txtdlgGenStyle",label:ab.lang.common.cssStyle,"default":"",setup:function(i,h){if(i==Z){var g=h.getAttribute("style");if(!g&&h.$.style.cssText){g=h.$.style.cssText}this.setValue(g);var f=h.$.style.height,e=h.$.style.width,d=(f?f:"").match(V),c=(e?e:"").match(V);this.attributesInStyle={height:!!d,width:!!c}}},onChange:function(){O.call(this,["info:cmbFloat","info:cmbAlign","info:txtVSpace","info:txtHSpace","info:txtBorder","info:txtWidth","info:txtHeight"]);R(this)},commit:function(d,c){if(d==Z&&(this.getValue()||this.isChanged())){c.setAttribute("style",this.getValue())}}}]}]}};CKEDITOR.dialog.add("image",function(a){return b(a,"image")});CKEDITOR.dialog.add("imagebutton",function(a){return b(a,"imagebutton")})})();