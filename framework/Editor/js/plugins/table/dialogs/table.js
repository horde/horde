(function(){var f=/^(\d+(?:\.\d+)?)(px|%)$/,e=/^(\d+(?:\.\d+)?)px$/,h=function(b){var a=this.id;if(!b.info){b.info={}}b.info[a]=this.getValue()};function g(d,c){var b=function(j){return new CKEDITOR.dom.element(j,d.document)},a=d.plugins.dialogadvtab;return{title:d.lang.table.title,minWidth:310,minHeight:CKEDITOR.env.ie?310:280,onLoad:function(){var l=this,k=l.getContentElement("advanced","advStyles");if(k){k.on("change",function(r){var j=this.getStyle("width",""),i=l.getContentElement("info","txtWidth"),v=l.getContentElement("info","cmbWidthType"),u=1;if(j){u=j.length<3||j.substr(j.length-1)!="%";j=parseInt(j,10)}i&&i.setValue(j,true);v&&v.setValue(u?"pixels":"percents",true);var t=this.getStyle("height",""),s=l.getContentElement("info","txtHeight");t&&(t=parseInt(t,10));s&&s.setValue(t,true)})}},onShow:function(){var r=this;var z=d.getSelection(),y=z.getRanges(),x=null,w=r.getContentElement("info","txtRows"),v=r.getContentElement("info","txtCols"),u=r.getContentElement("info","txtWidth"),t=r.getContentElement("info","txtHeight");if(c=="tableProperties"){if(x=z.getSelectedElement()){x=x.getAscendant("table",true)}else{if(y.length>0){if(CKEDITOR.env.webkit){y[0].shrink(CKEDITOR.NODE_ELEMENT)}var s=y[0].getCommonAncestor(true);x=s.getAscendant("table",true)}}r._.selectedElement=x}if(x){r.setupContent(x);w&&w.disable();v&&v.disable()}else{w&&w.enable();v&&v.enable()}u&&u.onChange();t&&t.onChange()},onOk:function(){var M=this;if(M._.selectedElement){var Z=d.getSelection(),Y=Z.createBookmarks()}var X=M._.selectedElement||b("table"),W=M,V={};M.commitContent(V,X);if(V.info){var U=V.info;if(!M._.selectedElement){var T=X.append(b("tbody")),S=parseInt(U.txtRows,10)||0,Q=parseInt(U.txtCols,10)||0;for(var O=0;O<S;O++){var L=T.append(b("tr"));for(var K=0;K<Q;K++){var J=L.append(b("td"));if(!CKEDITOR.env.ie){J.append(b("br"))}}}}var I=U.selHeaders;if(!X.$.tHead&&(I=="row"||I=="both")){var H=new CKEDITOR.dom.element(X.$.createTHead());T=X.getElementsByTag("tbody").getItem(0);var G=T.getElementsByTag("tr").getItem(0);for(O=0;O<G.getChildCount();O++){var F=G.getChild(O);if(F.type==CKEDITOR.NODE_ELEMENT&&!F.hasAttribute("_cke_bookmark")){F.renameNode("th");F.setAttribute("scope","col")}}H.append(G.remove())}if(X.$.tHead!==null&&!(I=="row"||I=="both")){H=new CKEDITOR.dom.element(X.$.tHead);T=X.getElementsByTag("tbody").getItem(0);var E=T.getFirst();while(H.getChildCount()>0){G=H.getFirst();for(O=0;O<G.getChildCount();O++){var R=G.getChild(O);if(R.type==CKEDITOR.NODE_ELEMENT){R.renameNode("td");R.removeAttribute("scope")}}G.insertBefore(E)}H.remove()}if(!M.hasColumnHeaders&&(I=="col"||I=="both")){for(L=0;L<X.$.rows.length;L++){R=new CKEDITOR.dom.element(X.$.rows[L].cells[0]);R.renameNode("th");R.setAttribute("scope","row")}}if(M.hasColumnHeaders&&!(I=="col"||I=="both")){for(O=0;O<X.$.rows.length;O++){L=new CKEDITOR.dom.element(X.$.rows[O]);if(L.getParent().getName()=="tbody"){R=new CKEDITOR.dom.element(L.$.cells[0]);R.renameNode("td");R.removeAttribute("scope")}}}var P=[];if(U.txtHeight){X.setStyle("height",CKEDITOR.tools.cssLength(U.txtHeight))}else{X.removeStyle("height")}if(U.txtWidth){var N=U.cmbWidthType||"pixels";X.setStyle("width",U.txtWidth+(N=="pixels"?"px":"%"))}else{X.removeStyle("width")}if(!X.getAttribute("style")){X.removeAttribute("style")}}if(!M._.selectedElement){d.insertElement(X)}else{Z.selectBookmarks(Y)}return true},contents:[{id:"info",label:d.lang.table.title,elements:[{type:"hbox",widths:[null,null],styles:["vertical-align:top"],children:[{type:"vbox",padding:0,children:[{type:"text",id:"txtRows","default":3,label:d.lang.table.rows,required:true,style:"width:5em",validate:function(){var l=true,k=this.getValue();l=l&&CKEDITOR.dialog.validate.integer()(k)&&k>0;if(!l){alert(d.lang.table.invalidRows);this.select()}return l},setup:function(j){this.setValue(j.$.rows.length)},commit:h},{type:"text",id:"txtCols","default":2,label:d.lang.table.columns,required:true,style:"width:5em",validate:function(){var l=true,k=this.getValue();l=l&&CKEDITOR.dialog.validate.integer()(k)&&k>0;if(!l){alert(d.lang.table.invalidCols);this.select()}return l},setup:function(j){this.setValue(j.$.rows[0].cells.length)},commit:h},{type:"html",html:"&nbsp;"},{type:"select",id:"selHeaders","default":"",label:d.lang.table.headers,items:[[d.lang.table.headersNone,""],[d.lang.table.headersRow,"row"],[d.lang.table.headersColumn,"col"],[d.lang.table.headersBoth,"both"]],setup:function(n){var m=this.getDialog();m.hasColumnHeaders=true;for(var l=0;l<n.$.rows.length;l++){if(n.$.rows[l].cells[0].nodeName.toLowerCase()!="th"){m.hasColumnHeaders=false;break}}if(n.$.tHead!==null){this.setValue(m.hasColumnHeaders?"both":"row")}else{this.setValue(m.hasColumnHeaders?"col":"")}},commit:h},{type:"text",id:"txtBorder","default":1,label:d.lang.table.border,style:"width:3em",validate:CKEDITOR.dialog.validate.number(d.lang.table.invalidBorder),setup:function(j){this.setValue(j.getAttribute("border")||"")},commit:function(l,k){if(this.getValue()){k.setAttribute("border",this.getValue())}else{k.removeAttribute("border")}}},{id:"cmbAlign",type:"select","default":"",label:d.lang.table.align,items:[[d.lang.common.notSet,""],[d.lang.table.alignLeft,"left"],[d.lang.table.alignCenter,"center"],[d.lang.table.alignRight,"right"]],setup:function(j){this.setValue(j.getAttribute("align")||"")},commit:function(l,k){if(this.getValue()){k.setAttribute("align",this.getValue())}else{k.removeAttribute("align")}}}]},{type:"vbox",padding:0,children:[{type:"hbox",widths:["5em"],children:[{type:"text",id:"txtWidth",style:"width:5em",label:d.lang.table.width,"default":500,validate:CKEDITOR.dialog.validate.number(d.lang.table.invalidWidth),onLoad:function(){var p=this.getDialog().getContentElement("info","cmbWidthType"),o=p.getElement(),n=this.getInputElement(),m=n.getAttribute("aria-labelledby");n.setAttribute("aria-labelledby",[m,o.$.id].join(" "))},onChange:function(){var l=this.getDialog().getContentElement("advanced","advStyles");if(l){var k=this.getValue();if(k){k+=this.getDialog().getContentElement("info","cmbWidthType").getValue()=="percents"?"%":"px"}l.updateStyle("width",k)}},setup:function(l){var k=f.exec(l.$.style.width);if(k){this.setValue(k[1])}else{this.setValue("")}},commit:h},{id:"cmbWidthType",type:"select",label:d.lang.table.widthUnit,labelStyle:"visibility:hidden","default":"pixels",items:[[d.lang.table.widthPx,"pixels"],[d.lang.table.widthPc,"percents"]],setup:function(l){var k=f.exec(l.$.style.width);if(k){this.setValue(k[2]=="px"?"pixels":"percents")}},onChange:function(){this.getDialog().getContentElement("info","txtWidth").onChange()},commit:h}]},{type:"hbox",widths:["5em"],children:[{type:"text",id:"txtHeight",style:"width:5em",label:d.lang.table.height,"default":"",validate:CKEDITOR.dialog.validate.number(d.lang.table.invalidHeight),onLoad:function(){var p=this.getDialog().getContentElement("info","htmlHeightType"),o=p.getElement(),n=this.getInputElement(),m=n.getAttribute("aria-labelledby");n.setAttribute("aria-labelledby",[m,o.$.id].join(" "))},onChange:function(){var l=this.getDialog().getContentElement("advanced","advStyles");if(l){var k=this.getValue();l.updateStyle("height",k&&k+"px")}},setup:function(l){var k=e.exec(l.$.style.height);if(k){this.setValue(k[1])}},commit:h},{id:"htmlHeightType",type:"html",html:"<div><br />"+d.lang.table.widthPx+"</div>"}]},{type:"html",html:"&nbsp;"},{type:"text",id:"txtCellSpace",style:"width:3em",label:d.lang.table.cellSpace,"default":1,validate:CKEDITOR.dialog.validate.number(d.lang.table.invalidCellSpacing),setup:function(j){this.setValue(j.getAttribute("cellSpacing")||"")},commit:function(l,k){if(this.getValue()){k.setAttribute("cellSpacing",this.getValue())}else{k.removeAttribute("cellSpacing")}}},{type:"text",id:"txtCellPad",style:"width:3em",label:d.lang.table.cellPad,"default":1,validate:CKEDITOR.dialog.validate.number(d.lang.table.invalidCellPadding),setup:function(j){this.setValue(j.getAttribute("cellPadding")||"")},commit:function(l,k){if(this.getValue()){k.setAttribute("cellPadding",this.getValue())}else{k.removeAttribute("cellPadding")}}}]}]},{type:"html",align:"right",html:""},{type:"vbox",padding:0,children:[{type:"text",id:"txtCaption",label:d.lang.table.caption,setup:function(n){var m=n.getElementsByTag("caption");if(m.count()>0){var l=m.getItem(0);l=CKEDITOR.tools.trim(l.getText());this.setValue(l)}},commit:function(r,q){var p=this.getValue(),o=q.getElementsByTag("caption");if(p){if(o.count()>0){o=o.getItem(0);o.setHtml("")}else{o=new CKEDITOR.dom.element("caption",d.document);if(q.getChildCount()){o.insertBefore(q.getFirst())}else{o.appendTo(q)}}o.append(new CKEDITOR.dom.text(p,d.document))}else{if(o.count()>0){for(var n=o.count()-1;n>=0;n--){o.getItem(n).remove()}}}}},{type:"text",id:"txtSummary",label:d.lang.table.summary,setup:function(j){this.setValue(j.getAttribute("summary")||"")},commit:function(l,k){if(this.getValue()){k.setAttribute("summary",this.getValue())}else{k.removeAttribute("summary")}}}]}]},a&&a.createAdvancedTab(d)]}}CKEDITOR.dialog.add("table",function(a){return g(a,"table")});CKEDITOR.dialog.add("tableProperties",function(a){return g(a,"tableProperties")})})();