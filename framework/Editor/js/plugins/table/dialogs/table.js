(function(){var g=CKEDITOR.tools.cssLength,f=function(b){var a=this.id;if(!b.info){b.info={}}b.info[a]=this.getValue()};function j(r){var q=0,p=0;for(var o=0,e,d=r.$.rows.length;o<d;o++){e=r.$.rows[o],q=0;for(var c=0,b,a=e.cells.length;c<a;c++){b=e.cells[c];q+=b.colSpan}q>p&&(p=q)}return p}function i(a){return function(){var c=this.getValue(),b=!!(CKEDITOR.dialog.validate.integer()(c)&&c>0);if(!b){alert(a);this.select()}return b}}function h(d,c){var b=function(e){return new CKEDITOR.dom.element(e,d.document)},a=d.plugins.dialogadvtab;return{title:d.lang.table.title,minWidth:310,minHeight:CKEDITOR.env.ie?310:280,onLoad:function(){var l=this,e=l.getContentElement("advanced","advStyles");if(e){e.on("change",function(q){var k=this.getStyle("width",""),t=l.getContentElement("info","txtWidth");t&&t.setValue(k,true);var s=this.getStyle("height",""),r=l.getContentElement("info","txtHeight");r&&r.setValue(s,true)})}},onShow:function(){var e=this;var z=d.getSelection(),y=z.getRanges(),x=null,w=e.getContentElement("info","txtRows"),v=e.getContentElement("info","txtCols"),u=e.getContentElement("info","txtWidth"),t=e.getContentElement("info","txtHeight");if(c=="tableProperties"){if(x=z.getSelectedElement()){x=x.getAscendant("table",true)}else{if(y.length>0){if(CKEDITOR.env.webkit){y[0].shrink(CKEDITOR.NODE_ELEMENT)}var s=y[0].getCommonAncestor(true);x=s.getAscendant("table",true)}}e._.selectedElement=x}if(x){e.setupContent(x);w&&w.disable();v&&v.disable()}else{w&&w.enable();v&&v.enable()}u&&u.onChange();t&&t.onChange()},onOk:function(){var V=d.getSelection(),U=this._.selectedElement&&V.createBookmarks(),T=this._.selectedElement||b("table"),S=this,R={};this.commitContent(R,T);if(R.info){var Q=R.info;if(!this._.selectedElement){var P=T.append(b("tbody")),N=parseInt(Q.txtRows,10)||0,L=parseInt(Q.txtCols,10)||0;for(var J=0;J<N;J++){var I=P.append(b("tr"));for(var H=0;H<L;H++){var G=I.append(b("td"));if(!CKEDITOR.env.ie){G.append(b("br"))}}}}var F=Q.selHeaders;if(!T.$.tHead&&(F=="row"||F=="both")){var E=new CKEDITOR.dom.element(T.$.createTHead());P=T.getElementsByTag("tbody").getItem(0);var D=P.getElementsByTag("tr").getItem(0);for(J=0;J<D.getChildCount();J++){var e=D.getChild(J);if(e.type==CKEDITOR.NODE_ELEMENT&&!e.data("cke-bookmark")){e.renameNode("th");e.setAttribute("scope","col")}}E.append(D.remove())}if(T.$.tHead!==null&&!(F=="row"||F=="both")){E=new CKEDITOR.dom.element(T.$.tHead);P=T.getElementsByTag("tbody").getItem(0);var O=P.getFirst();while(E.getChildCount()>0){D=E.getFirst();for(J=0;J<D.getChildCount();J++){var M=D.getChild(J);if(M.type==CKEDITOR.NODE_ELEMENT){M.renameNode("td");M.removeAttribute("scope")}}D.insertBefore(O)}E.remove()}if(!this.hasColumnHeaders&&(F=="col"||F=="both")){for(I=0;I<T.$.rows.length;I++){M=new CKEDITOR.dom.element(T.$.rows[I].cells[0]);M.renameNode("th");M.setAttribute("scope","row")}}if(this.hasColumnHeaders&&!(F=="col"||F=="both")){for(J=0;J<T.$.rows.length;J++){I=new CKEDITOR.dom.element(T.$.rows[J]);if(I.getParent().getName()=="tbody"){M=new CKEDITOR.dom.element(I.$.cells[0]);M.renameNode("td");M.removeAttribute("scope")}}}Q.txtHeight?T.setStyle("height",Q.txtHeight):T.removeStyle("height");Q.txtWidth?T.setStyle("width",Q.txtWidth):T.removeStyle("width");if(!T.getAttribute("style")){T.removeAttribute("style")}}if(!this._.selectedElement){d.insertElement(T);setTimeout(function(){var l=new CKEDITOR.dom.element(T.$.rows[0].cells[0]),k=new CKEDITOR.dom.range(d.document);k.moveToPosition(l,CKEDITOR.POSITION_AFTER_START);k.select(1)},0)}else{try{V.selectBookmarks(U)}catch(K){}}},contents:[{id:"info",label:d.lang.table.title,elements:[{type:"hbox",widths:[null,null],styles:["vertical-align:top"],children:[{type:"vbox",padding:0,children:[{type:"text",id:"txtRows","default":3,label:d.lang.table.rows,required:true,controlStyle:"width:5em",validate:i(d.lang.table.invalidRows),setup:function(e){this.setValue(e.$.rows.length)},commit:f},{type:"text",id:"txtCols","default":2,label:d.lang.table.columns,required:true,controlStyle:"width:5em",validate:i(d.lang.table.invalidCols),setup:function(e){this.setValue(j(e))},commit:f},{type:"html",html:"&nbsp;"},{type:"select",id:"selHeaders","default":"",label:d.lang.table.headers,items:[[d.lang.table.headersNone,""],[d.lang.table.headersRow,"row"],[d.lang.table.headersColumn,"col"],[d.lang.table.headersBoth,"both"]],setup:function(p){var o=this.getDialog();o.hasColumnHeaders=true;for(var n=0;n<p.$.rows.length;n++){var e=p.$.rows[n].cells[0];if(e&&e.nodeName.toLowerCase()!="th"){o.hasColumnHeaders=false;break}}if(p.$.tHead!==null){this.setValue(o.hasColumnHeaders?"both":"row")}else{this.setValue(o.hasColumnHeaders?"col":"")}},commit:f},{type:"text",id:"txtBorder","default":1,label:d.lang.table.border,controlStyle:"width:3em",validate:CKEDITOR.dialog.validate.number(d.lang.table.invalidBorder),setup:function(e){this.setValue(e.getAttribute("border")||"")},commit:function(l,e){if(this.getValue()){e.setAttribute("border",this.getValue())}else{e.removeAttribute("border")}}},{id:"cmbAlign",type:"select","default":"",label:d.lang.common.align,items:[[d.lang.common.notSet,""],[d.lang.common.alignLeft,"left"],[d.lang.common.alignCenter,"center"],[d.lang.common.alignRight,"right"]],setup:function(e){this.setValue(e.getAttribute("align")||"")},commit:function(l,e){if(this.getValue()){e.setAttribute("align",this.getValue())}else{e.removeAttribute("align")}}}]},{type:"vbox",padding:0,children:[{type:"hbox",widths:["5em"],children:[{type:"text",id:"txtWidth",controlStyle:"width:5em",label:d.lang.common.width,title:d.lang.common.cssLengthTooltip,"default":500,getValue:g,validate:CKEDITOR.dialog.validate.cssLength(d.lang.common.invalidCssLength.replace("%1",d.lang.common.width)),onChange:function(){var e=this.getDialog().getContentElement("advanced","advStyles");e&&e.updateStyle("width",this.getValue())},setup:function(l){var e=l.getStyle("width");e&&this.setValue(e)},commit:f}]},{type:"hbox",widths:["5em"],children:[{type:"text",id:"txtHeight",controlStyle:"width:5em",label:d.lang.common.height,title:d.lang.common.cssLengthTooltip,"default":"",getValue:g,validate:CKEDITOR.dialog.validate.cssLength(d.lang.common.invalidCssLength.replace("%1",d.lang.common.height)),onChange:function(){var e=this.getDialog().getContentElement("advanced","advStyles");e&&e.updateStyle("height",this.getValue())},setup:function(l){var e=l.getStyle("height");e&&this.setValue(e)},commit:f}]},{type:"html",html:"&nbsp;"},{type:"text",id:"txtCellSpace",controlStyle:"width:3em",label:d.lang.table.cellSpace,"default":1,validate:CKEDITOR.dialog.validate.number(d.lang.table.invalidCellSpacing),setup:function(e){this.setValue(e.getAttribute("cellSpacing")||"")},commit:function(l,e){if(this.getValue()){e.setAttribute("cellSpacing",this.getValue())}else{e.removeAttribute("cellSpacing")}}},{type:"text",id:"txtCellPad",controlStyle:"width:3em",label:d.lang.table.cellPad,"default":1,validate:CKEDITOR.dialog.validate.number(d.lang.table.invalidCellPadding),setup:function(e){this.setValue(e.getAttribute("cellPadding")||"")},commit:function(l,e){if(this.getValue()){e.setAttribute("cellPadding",this.getValue())}else{e.removeAttribute("cellPadding")}}}]}]},{type:"html",align:"right",html:""},{type:"vbox",padding:0,children:[{type:"text",id:"txtCaption",label:d.lang.table.caption,setup:function(q){var r=this;r.enable();var p=q.getElementsByTag("caption");if(p.count()>0){var o=p.getItem(0),e=o.getFirst(CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_ELEMENT));if(e&&!e.equals(o.getBogus())){r.disable();r.setValue(o.getText());return}o=CKEDITOR.tools.trim(o.getText());r.setValue(o)}},commit:function(q,p){if(!this.isEnabled()){return}var o=this.getValue(),e=p.getElementsByTag("caption");if(o){if(e.count()>0){e=e.getItem(0);e.setHtml("")}else{e=new CKEDITOR.dom.element("caption",d.document);if(p.getChildCount()){e.insertBefore(p.getFirst())}else{e.appendTo(p)}}e.append(new CKEDITOR.dom.text(o,d.document))}else{if(e.count()>0){for(var r=e.count()-1;r>=0;r--){e.getItem(r).remove()}}}}},{type:"text",id:"txtSummary",label:d.lang.table.summary,setup:function(e){this.setValue(e.getAttribute("summary")||"")},commit:function(l,e){if(this.getValue()){e.setAttribute("summary",this.getValue())}else{e.removeAttribute("summary")}}}]}]},a&&a.createAdvancedTab(d)]}}CKEDITOR.dialog.add("table",function(a){return h(a,"table")});CKEDITOR.dialog.add("tableProperties",function(a){return h(a,"tableProperties")})})();