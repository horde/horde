var ContextSensitive=Class.create({initialize:function(){this.current=this.target=null;this.elements=$H();document.observe("contextmenu",this.rightClickHandler.bindAsEventListener(this));document.observe("click",this.leftClickHandler.bindAsEventListener(this));document.observe(Prototype.Browser.Gecko?"DOMMouseScroll":"mousescroll",this.close.bind(this))},addElement:function(D,C,A){var B=Boolean(A.left);if(D&&!this.validElement(D,B)){this.elements.set(D+Number(B),new ContextSensitive.Element(D,C,A))}},removeElement:function(A){this.elements.unset(A+"0");this.elements.unset(A+"1")},close:function(A){if(this.current){if(A){this.current.hide()}else{Effect.Fade(this.current,{duration:0.2})}this.current=this.target=null}},element:function(){return this.target},currentmenu:function(){if(this.current&&this.current.visible()){return this.current}},validElement:function(B,A){return this.elements.get(B+Number(Boolean(A)))},disable:function(D,C,A){var B=this.validElement(D,C);if(B){B.disable=A}},leftClickHandler:function(A){if(A.isRightClick()){return}this.rightClickHandler(A,true)},rightClickHandler:function(B,A){if(this.trigger(B.element(),A,B.pointerX(),B.pointerY())){B.stop()}},trigger:function(F,E,H,G){var J,B,D,C,K,I,A;[F].concat(F.ancestors()).find(function(L){J=this.validElement(L.id,E);return J},this);if(!J||J.disable){this.close();return false}B=$(J.ctx);if(!B){this.close();return false}else{if(E&&B==this.current){return false}}this.current=B;this.target=$(J.id);D=J.opts.offset;if(!D&&(Object.isUndefined(H)||Object.isUndefined(G))){D=F.id}D=$(D);if(D){C=D.viewportOffset();A=document.viewport.getScrollOffsets();H=C[0]+A.left;G=C[1]+D.getHeight()+A.top}I=document.viewport.getDimensions();K=B.getDimensions();if((G+K.height)>I.height){G=I.height-K.height-10}if((H+K.width)>I.width){H=I.width-K.width-10}if(J.opts.onShow){J.opts.onShow(J)}Effect.Appear(B.setStyle({left:H+"px",top:G+"px"}),{duration:0.2});return true}});ContextSensitive.Element=Class.create({initialize:function(C,B,A){this.id=C;this.ctx=B;this.opts=A;this.opts.left=Boolean(A.left);this.disable=false}});